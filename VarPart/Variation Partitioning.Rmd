---
title: "Variation Partitioning"
author: "Rodolfo Pelinson"
date: "07/04/2021"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


First we have to load the separated data matrices we need. The data matrices are prepared sourcing the "Loading_data.R" file in the Auxiliary Scripts folder.
```{r, echo=TRUE, eval=FALSE}
library(AtlanticForestMetacommunity)
source("Loading_data.R")
```


```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
library(AtlanticForestMetacommunity)
source("C:/Users/rodol/OneDrive/Trabalho/Papers/Analysis/AtlanticForestMetacommunity/Auxiliary Scripts/Loading_data.R")
```

The used packages to run this analysis are:

`vegan` version 2.5-6   
`ade4` version 1.7-15   
`adespatial` version 0.3-8   

Some packages used to generate plots and tables

`dplyr` version 0.8.5   
`plotrix` version 3.7-8   

```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
library(vegan)
library(ade4)
library(adespatial)
library(dplyr)
library(plotrix)
```
\  
\  
\  
\  

## Reducing Multicolinearity

To remove multicolinear variables from our Environmental Matrix I built a function that removes variables with the variance inflation factor (VIF) higher than 3. The function `VIF_selection()` simply uses the `vif.cca()` from the `vegan` package. 
```{r}
Broad_env_VIF <- VIF_selection(Broad_pa,  Broad_env_st[,-6])

SSF_env_VIF <- VIF_selection(SSF_pa,  SSF_env_st)
ST_env_VIF <- VIF_selection(ST_pa,  ST_env_st)
IC_env_VIF <- VIF_selection(IC_pa,  IC_env_st)
NI_env_VIF <- VIF_selection(NI_pa,  NI_env_st)
MD_env_VIF <- VIF_selection(MD_pa,  MD_env_st)
JA_env_VIF <- VIF_selection(JA_pa,  JA_env_st)

DRF_env_VIF <- VIF_selection(DRF_pa,  DRF_env_st)
UBA_env_VIF <- VIF_selection(UBA_pa,  UBA_env_st)
BER_env_VIF <- VIF_selection(BER_pa,  BER_env_st)
ITA_env_VIF <- VIF_selection(ITA_pa,  ITA_env_st)
```
\  
\  


Same thing for climate variables
```{r}
Broad_clim_VIF <- VIF_selection(Broad_pa,  Broad_clim_st[,-6])
SSF_clim_VIF <- VIF_selection(SSF_pa,  SSF_clim_st)
DRF_clim_VIF <- VIF_selection(DRF_pa,  DRF_clim_st)
```
\  
\  

## Spatial Variables

Constructing matrices of spatial filters
```{r}
Broad_dbMEM <- dbmem(dist(Broad_coord), silent = F, thresh = NULL)

SSF_dbMEM <- dbmem(dist(SSF_coord), silent = F, thresh = NULL)
ST_dbMEM <- dbmem(dist(ST_coord), silent = F, thresh = NULL)
IC_dbMEM <- dbmem(dist(IC_coord), silent = F, thresh = NULL)
NI_dbMEM <- dbmem(dist(NI_coord), silent = F, thresh = NULL)
MD_dbMEM <- dbmem(dist(MD_coord), silent = F, thresh = NULL)
JA_dbMEM <- dbmem(dist(JA_coord), silent = F, thresh = NULL)

DRF_dbMEM <- dbmem(dist(DRF_coord), silent = F, thresh = NULL)
UBA_dbMEM <- dbmem(dist(UBA_coord), silent = F, thresh = NULL)
BER_dbMEM <- dbmem(dist(BER_coord), silent = F, thresh = NULL)
ITA_dbMEM <- dbmem(dist(ITA_coord), silent = F, thresh = NULL)

```
\  
\  
\  
\  


## Forward Selection

Similarly to removing variables with VIF higher than 3, I built a function to select the most important variables, when they could significantly explain species occurrences. This function mostly rely on the function `fs()` from package `adespatial`. Forward selection is only performed when the whole predictor matrix can significantly explain (p < 0.05) the variation in species occurrences.


### Broad Spatial Extent
```{r, cache = TRUE, warning=FALSE}
Broad_env_FS <- forward_selection(Broad_pa, Broad_env_VIF)
Broad_clim_FS <- forward_selection(Broad_pa, Broad_clim_VIF)
Broad_dbMEM_FS <- forward_selection(Broad_pa, Broad_dbMEM)
```


<span style="color: #D4AC0D;">Retained Environmental Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(Broad_env_FS)
```

<span style="color: #CB4335;">Retained Climate Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(Broad_clim_FS)
```

<span style="color: #3498DB;">Retained Spatial Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(Broad_dbMEM_FS)
```
\  
\  

### Intermediate Spatial Extent
#### DRF
```{r, cache = TRUE, warning=FALSE}
DRF_env_FS <- forward_selection(DRF_pa, DRF_env_VIF)
DRF_clim_FS <- forward_selection(DRF_pa, DRF_clim_VIF)
DRF_dbMEM_FS <- forward_selection(DRF_pa, DRF_dbMEM)
```

<span style="color: #D4AC0D;">Retained Environmental Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(DRF_env_FS)
```

<span style="color: #CB4335;">Retained Climate Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(DRF_clim_FS)
```

<span style="color: #3498DB;">Retained Spatial Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(DRF_dbMEM_FS)
```
\  
\ 

#### SSF
```{r, cache = TRUE, warning=FALSE}
SSF_env_FS <- forward_selection(SSF_pa, SSF_env_VIF)
SSF_clim_FS <- forward_selection(SSF_pa, SSF_clim_VIF)
SSF_dbMEM_FS <- forward_selection(SSF_pa, SSF_dbMEM)
```

<span style="color: #D4AC0D;">Retained Environmental Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(SSF_env_FS)
```

<span style="color: #CB4335;">Retained Climate Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(SSF_clim_FS)
```

<span style="color: #3498DB;">Retained Spatial Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(SSF_dbMEM_FS)
```
\  
\  


### Small Spatial Extent
#### DRF
Ubatuba
```{r, cache = TRUE, warning=FALSE}
UBA_env_FS <- forward_selection(UBA_pa, UBA_env_VIF)
UBA_dbMEM_FS <- forward_selection(UBA_pa, UBA_dbMEM)
```

<span style="color: #D4AC0D;">Retained Environmental Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(UBA_env_FS)
```

<span style="color: #3498DB;">Retained Spatial Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(UBA_dbMEM_FS)
```
\  
\  

Bertioga
```{r, cache = TRUE, warning=FALSE}
BER_env_FS <- forward_selection(BER_pa, BER_env_VIF)
BER_dbMEM_FS <- forward_selection(BER_pa, BER_dbMEM)
```

<span style="color: #D4AC0D;">Retained Environmental Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(BER_env_FS)
```

<span style="color: #3498DB;">Retained Spatial Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(BER_dbMEM_FS)
```
\  
\  

Itanhaém
```{r, cache = TRUE, warning=FALSE}
ITA_env_FS <- forward_selection(ITA_pa, ITA_env_VIF)
ITA_dbMEM_FS <- forward_selection(ITA_pa, ITA_dbMEM)
```

<span style="color: #D4AC0D;">Retained Environmental Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(ITA_env_FS)
```

<span style="color: #3498DB;">Retained Spatial Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(ITA_dbMEM_FS)
```
\  
\  

#### SSF
Santa Fé do Sul
```{r, cache = TRUE, warning=FALSE}
ST_env_FS <- forward_selection(ST_pa, ST_env_VIF)
ST_dbMEM_FS <- forward_selection(ST_pa, ST_dbMEM)
```

<span style="color: #D4AC0D;">Retained Environmental Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(ST_env_FS)
```

<span style="color: #3498DB;">Retained Spatial Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(ST_dbMEM_FS)
```
\  
\  


Icém
```{r, cache = TRUE, warning=FALSE}
IC_env_FS <- forward_selection(IC_pa, IC_env_VIF)
IC_dbMEM_FS <- forward_selection(IC_pa, IC_dbMEM)
```

<span style="color: #D4AC0D;">Retained Environmental Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(IC_env_FS)
```

<span style="color: #3498DB;">Retained Spatial Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(IC_dbMEM_FS)
```
\  
\  

Nova Itapirema
```{r, cache = TRUE, warning=FALSE}
NI_env_FS <- forward_selection(NI_pa, NI_env_VIF)
NI_dbMEM_FS <- forward_selection(NI_pa, NI_dbMEM)
```

<span style="color: #D4AC0D;">Retained Environmental Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(NI_env_FS)
```

<span style="color: #3498DB;">Retained Spatial Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(NI_dbMEM_FS)
```
\  
\  

Morro do Diabo
```{r, cache = TRUE, warning=FALSE}
MD_env_FS <- forward_selection(MD_pa, MD_env_VIF)
MD_dbMEM_FS <- forward_selection(MD_pa, MD_dbMEM)
```

<span style="color: #D4AC0D;">Retained Environmental Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(MD_env_FS)
```

<span style="color: #3498DB;">Retained Spatial Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(MD_dbMEM_FS)
```
\  
\  

Jataí
```{r, cache = TRUE, warning=FALSE}
JA_env_FS <- forward_selection(JA_pa, JA_env_VIF)
JA_dbMEM_FS <- forward_selection(JA_pa, JA_dbMEM)
```

<span style="color: #D4AC0D;">Retained Environmental Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(JA_env_FS)
```

<span style="color: #3498DB;">Retained Spatial Variables</span>
```{r, cache = TRUE, warning=FALSE}
colnames(JA_dbMEM_FS)
```
\  
\  
\  
\  



We can plot the important spatial variables to better understand what spatial patterns they describe.

Large Scale MEM 1, 2, 3 and 4.
```{r, fig.width= 6, fig.height=6,out.width= 800, out.height=800 , fig.align='center', dpi = 200}
par(mfrow = c(2,2))
sr_value(Broad_coord, Broad_dbMEM_FS[,1], ylim = c(-24.49270,-20.17833), xlim = c(-52.64536, -44.51492), grid=F, csize = 0.8, clegend = 1, xax = 2, yax = 1, method = "bubble")
title(main = "LARGE SCALE MEM 1", line = 3, outer = F, adj = 1)

sr_value(Broad_coord, Broad_dbMEM_FS[,2], ylim = c(-24.49270,-20.17833), xlim = c(-52.64536, -44.51492), grid=F, csize = 0.8, clegend = 1, xax = 2, yax = 1, method = "bubble")
title(main = "LARGE SCALE MEM 2", line = 3, outer = F, adj = 1)

sr_value(Broad_coord, Broad_dbMEM_FS[,3], ylim = c(-24.49270,-20.17833), xlim = c(-52.64536, -44.51492), grid=F, csize = 0.8, clegend = 1, xax = 2, yax = 1, method = "bubble")
title(main = "LARGE SCALE MEM 3", line = 3, outer = F, adj = 1)

sr_value(Broad_coord, Broad_dbMEM_FS[,4], ylim = c(-24.49270,-20.17833), xlim = c(-52.64536, -44.51492), grid=F, csize = 0.8, clegend = 1, xax = 2, yax = 1, method = "bubble")
title(main = "LARGE SCALE MEM 4", line = 3, outer = F, adj = 1)

```

\  
\  
\  
\  



Intermediate Scale DRF MEM 1.
```{r, fig.height= 3,fig.width=3,out.width= 400, out.height=400 , fig.align='center', dpi = 200}
par(mfrow = c(1,1))
sr_value(DRF_coord, DRF_dbMEM_FS[,1], ylim = c(-24.59270,-23.33123), xlim = c(-47.61181, -44.61492), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "DRF MEM 1", line = 3, outer = F, adj = 1)

```

\  
\  
\  
\  



Intermediate Scale SSF MEM 1.
```{r, fig.height= 3,fig.width=3,out.width= 400, out.height=400 , fig.align='center', dpi = 200}
sr_value(SSF_coord, SSF_dbMEM_FS[,1], ylim = c(-22.61958,-20.17833), xlim = c(-52.54536, -47.52589), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "SSF MEM 1", line = 3, outer = F, adj = 1)

```

\  
\  
\  
\  


Small Extent DRF - Ubatuba MEM 1
```{r, fig.height= 3,fig.width=3,out.width= 400, out.height=400 , fig.align='center', dpi = 200}
sr_value(UBA_coord, UBA_dbMEM_FS[,1], ylim = c(-23.37694,-23.33123), xlim = c(-44.95004, -44.80492), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "Ubatuba MEM 1", line = 3, outer = F, adj = 1)


```

\  
\  


Small Extent DRF - Bertioga MEM 1
```{r, fig.height= 3,fig.width=3,out.width= 400, out.height=400 , fig.align='center', dpi = 200}
sr_value(BER_coord, BER_dbMEM_FS[,1], ylim = c(-23.76198,-23.71684), xlim = c(-45.94223, -45.73709), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "Bertioga MEM 1", line = 3, outer = F, adj = 1)

```

\  
\  
\  
\  


Small Extent DRF - Itanhaém MEM 1 and 2.
```{r, fig.height= 3,fig.width=6,out.width= 800, out.height=400 , fig.align='center', dpi = 200}
par(mfrow = c(1,2))

sr_value(ITA_coord, ITA_dbMEM_FS[,1], ylim = c(-24.6527,-24.1786), xlim = c(-47.31181, -46.89443), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "Itanhaém MEM 1", line = 3, outer = F, adj = 1)


sr_value(ITA_coord, ITA_dbMEM_FS[,2], ylim = c(-24.6527,-24.1786), xlim = c(-47.31181, -46.89443), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "Itanhaém MEM 2", line = 3, outer = F, adj = 1)

```

\  
\  
\  
\  



Small Extent DRF - Santa Fé do Sul MEM 1 and 2.
```{r, fig.height= 3,fig.width=6,out.width= 800, out.height=400 , fig.align='center', dpi = 200}
par(mfrow = c(1,2))

sr_value(ST_coord, ST_dbMEM_FS[,1], ylim = c(-20.18789,-20.17733), xlim = c(-50.89639, -50.89056), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "Santa Fé do Sul MEM 1", line = 3, outer = F, adj = 1)


sr_value(ST_coord, ST_dbMEM_FS[,2], ylim = c(-20.18789,-20.17733), xlim = c(-50.89639, -50.89056), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "Santa Fé do Sul MEM 2", line = 3, outer = F, adj = 1)

```

\  
\  
\  
\  



Small Extent DRF - Icém MEM 1 and 2.
```{r, fig.height= 3,fig.width=6,out.width= 800, out.height=400 , fig.align='center', dpi = 200}
par(mfrow = c(1,2))

sr_value(IC_coord, IC_dbMEM_FS[,1], ylim = c(-20.375,-20.355), xlim = c(-49.28556, -49.18333), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "Icém MEM 1", line = 3, outer = F, adj = 1)


sr_value(IC_coord, IC_dbMEM_FS[,2], ylim = c(-20.375,-20.355), xlim = c(-49.28556, -49.18333), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "Icém MEM 2", line = 3, outer = F, adj = 1)

```

\  
\  
\  
\  





Small Extent DRF - Nova Itapirema MEM 1.
```{r, fig.height= 3,fig.width=3,out.width= 400, out.height=400 , fig.align='center', dpi = 200}
sr_value(NI_coord, NI_dbMEM_FS[,1], ylim = c(-21.08111,-21.07333), xlim = c(-49.54072, -49.51689), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "Nova Itapirema MEM 1", line = 3, outer = F, adj = 1)

```

\  
\  
\  
\  




Small Extent DRF - Morro do Diabo MEM 1.
```{r, fig.height= 3,fig.width=3,out.width= 400, out.height=400 , fig.align='center', dpi = 200}
sr_value(MD_coord, MD_dbMEM_FS[,1], ylim = c(-22.65958, -22.34950), xlim = c(-52.34536, -52.16550), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "Morro do Diabo MEM 1", line = 3, outer = F, adj = 1)

```

\  
\  
\  
\  



Small Extent DRF - Jataí MEM 1.
```{r, fig.height= 3,fig.width=3,out.width= 400, out.height=400 , fig.align='center', dpi = 200}
sr_value(JA_coord, JA_dbMEM_FS[,1], ylim = c(-21.58556, -21.56376), xlim = c(-47.79086, -47.72289), grid=F, csize = 0.8, clegend = 0.8, xax = 2, yax = 1, method = "bubble")
title(main = "Jataí MEM 1", line = 3, outer = F, adj = 1)

```

\  
\  
\  
\  


## Variation Partitioning
 
 

#### Large Extent
```{r, cache = TRUE}
#Variation partitioning Broad
Broad_varpart <- var_partitioning_1(Y = Broad_pa, 
                                       env = Broad_env_FS,
                                       clim = Broad_clim_FS,
                                       spa = Broad_dbMEM_FS, percent_r2 = F)
Broad_varpart
```
\  
\  
 
#### Intermediate Extent
```{r, cache = TRUE}
DRF_varpart <- var_partitioning_1(Y = DRF_pa, 
                                      env = DRF_env_FS,
                                      clim = DRF_clim_FS,
                                      spa = DRF_dbMEM_FS, percent_r2 = F)

SSF_varpart <- var_partitioning_1(Y = SSF_pa, 
                                      env = SSF_env_FS,
                                      clim = SSF_clim_FS,
                                      spa = SSF_dbMEM_FS, percent_r2 = F)

SSF_varpart
DRF_varpart
```
\  
\  
 
#### Small Extent

Small Extent allowing negative fractions
```{r, cache = TRUE}
ST_varpart <- var_partitioning_2(ST_pa, ST_env_FS, ST_dbMEM_FS, allow_negative_r2 = T, percent_r2 = F)
IC_varpart <- var_partitioning_2(IC_pa, IC_env_FS, IC_dbMEM_FS, allow_negative_r2 = T, percent_r2 = F)
NI_varpart <- var_partitioning_2(NI_pa, NI_env_FS, NI_dbMEM_FS, allow_negative_r2 = T, percent_r2 = F)
MD_varpart <- var_partitioning_2(MD_pa, MD_env_FS, MD_dbMEM_FS, allow_negative_r2 = T, percent_r2 = F)
JA_varpart <- var_partitioning_2(JA_pa, JA_env_FS, JA_dbMEM_FS, allow_negative_r2 = T, percent_r2 = F)

UBA_varpart <- var_partitioning_2(UBA_pa, UBA_env_FS, UBA_dbMEM_FS, allow_negative_r2 = T, percent_r2 = F)
BER_varpart <- var_partitioning_2(BER_pa, BER_env_FS, BER_dbMEM_FS, allow_negative_r2 = T, percent_r2 = F)
ITA_varpart <- var_partitioning_2(ITA_pa, ITA_env_FS, ITA_dbMEM_FS, allow_negative_r2 = T, percent_r2 = F)

ST_varpart
IC_varpart
NI_varpart
MD_varpart
JA_varpart

UBA_varpart
BER_varpart
ITA_varpart
```
\  
\  
  
  

Small Extent not allowing negative fractions
```{r, cache = TRUE}
ST_varpart2 <- var_partitioning_2(ST_pa, ST_env_FS, ST_dbMEM_FS, allow_negative_r2 = F, percent_r2 = F)
IC_varpart2 <- var_partitioning_2(IC_pa, IC_env_FS, IC_dbMEM_FS, allow_negative_r2 = F, percent_r2 = F)
NI_varpart2 <- var_partitioning_2(NI_pa, NI_env_FS, NI_dbMEM_FS, allow_negative_r2 = F, percent_r2 = F)
MD_varpart2 <- var_partitioning_2(MD_pa, MD_env_FS, MD_dbMEM_FS, allow_negative_r2 = F, percent_r2 = F)
JA_varpart2 <- var_partitioning_2(JA_pa, JA_env_FS, JA_dbMEM_FS, allow_negative_r2 = F, percent_r2 = F)

UBA_varpart2 <- var_partitioning_2(UBA_pa, UBA_env_FS, UBA_dbMEM_FS, allow_negative_r2 = F, percent_r2 = F)
BER_varpart2 <- var_partitioning_2(BER_pa, BER_env_FS, BER_dbMEM_FS, allow_negative_r2 = F, percent_r2 = F)
ITA_varpart2 <- var_partitioning_2(ITA_pa, ITA_env_FS, ITA_dbMEM_FS, allow_negative_r2 = F, percent_r2 = F)

ST_varpart2
IC_varpart2
NI_varpart2
MD_varpart2
JA_varpart2


UBA_varpart2
BER_varpart2
ITA_varpart2
```
\  
\  







Constructing a matrix with all R2 values 
```{r, message=FALSE, warning=FALSE}

Varpart_plot <- full_join(data.frame(rbind(Broad_varpart[,1])),
                          data.frame(rbind(SSF_varpart[,1])),)

Varpart_plot <- full_join(Varpart_plot,
                          data.frame(rbind(DRF_varpart[,1])))

Varpart_plot <- full_join(Varpart_plot,
                          data.frame(rbind(ST_varpart2[,1])))

Varpart_plot <- full_join(Varpart_plot,
                          data.frame(rbind(IC_varpart2[,1])))

Varpart_plot <- full_join(Varpart_plot,
                          data.frame(rbind(NI_varpart2[,1])))

Varpart_plot <- full_join(Varpart_plot,
                          data.frame(rbind(MD_varpart2[,1])))

Varpart_plot <- full_join(Varpart_plot,
                          data.frame(rbind(JA_varpart2[,1])))
                          
Varpart_plot <- full_join(Varpart_plot,
                          data.frame(rbind(UBA_varpart2[,1])))

Varpart_plot <- full_join(Varpart_plot,
                          data.frame(rbind(BER_varpart2[,1])))

Varpart_plot <- full_join(Varpart_plot,
                          data.frame(rbind(ITA_varpart2[,1])))

rownames(Varpart_plot) <- c("Broad", "SSF", "DRF", "Santa Fé do Sul", "Icém", "Nova Itapirema", "Morro do Diabo", "Jataí", "Ubatuba", "Bertioga", "Itanhaém")

Varpart_plot <- t(Varpart_plot)
for(i in 1:dim(Varpart_plot)[1]){
  for(j in 1:dim(Varpart_plot)[2]){
    if(is.na(Varpart_plot[i,j])){Varpart_plot[i,j] <- 0}
  }
}

Varpart_plot[12,2:3] <- Varpart_plot[12,2:3] + Varpart_plot[8,2:3]
Varpart_plot[8,2:3] <- 0 
Varpart_plot[5,c(4,5,6,7,9,10,11)] <- Varpart_plot[2,c(4,5,6,7,9,10,11)]
Varpart_plot[7,6] <- Varpart_plot[4,6]
Varpart_plot
```
\  
\    
\  
\      
  

Plotting the Variation Partioning as barplots.
```{r, fig.height= 7,fig.width=8,out.width= 800, out.height=700 , fig.align='center', dpi = 200}
Varpart_barplot <- Varpart_plot[-c(1:4),]
Varpart_barplot_break <- Varpart_barplot; Varpart_barplot_break[8,] <- Varpart_barplot_break[8,]-0.3
Varpart_barplot_break <- Varpart_barplot_break[c(1,4,3,6,2,5,7,8),]

barplot(as.matrix(Varpart_barplot_break), axes = F, col = c(Pure_Env = "gold",
                                                            Env_Spa = mix_color(alpha = 0.4,"gold","cornflowerblue"),
                                                            Pure_Spa = "cornflowerblue",
                                                            Spa_Clim  = mix_color(alpha = 0.4,"brown1","cornflowerblue"),
                                                            Pure_Clim = "brown1",
                                                            Env_Clim  = mix_color(alpha = 0.4,"brown1","gold"),
                                                            Spa_Clim_Env = mix_color(alpha = 0.7,"brown1","grey"),
                                                            Resid = "grey80"), space = c(0,2,1,2,1,1,1,1,2,1,1), border = "white",
        legend.text = c("Environment","Environment-Space","Space","Climate-Space","Climate","Climate-Environment","All three","Residual"), ylim = c(0,0.8),
        args.legend	= list(x = -0.5,y = 0.85, yjust = 1,xjust = 0, horiz = F, ncol = 4, box.col = "transparent",text.width = 5, border = "white"), axisnames= F, ylab = "Adjusted R²", cex.lab = 1.25)
axis(2, at = c(0,0.1,0.2,0.3,0.4,0.5,0.6, 0.7), labels = c("0 %","10 %","20 %","30 %","40 %","50 %","60 %","100 %"))
axis.break(2, 0.65, style = "slash") 
axis(1,at = c(0.5,4.5,16),line = 2, labels =c("Broad","Intermediate","Fine"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.3)
axis(1,at = c(12.5,21.5),line = 0.5, labels =c("SSF","DRF"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.1)
text(c(0.5,   3.5,5.5   ,8.5,10.5,12.5,14.5,16.5,    19.5,21.5,23.5),rep(0.69,11), labels =c("All","SSF","DRF","Santa Fé do Sul","Icém","Nova Itapirema","Morro do Diabo","Jataí","Ubatuba","Bertioga","Itanhaém"), srt = 90, adj = 1, col = "grey45")
text(c(10.5,12.5,16.5,19.5),c(0.1,0.08,0.17,0.03), labels =c("*","*","*","*","*"), adj = 0.5, col = "white", cex = 2)
text(c(0.5,0.5,0.5),c(0.02,0.07,0.2025), labels =c("*","*","*"), adj = 0.5, col = "white", cex = 2)
text(c(3.5,3.5,5.5),c(0.04,0.155,0.035), labels =c("*","*","*"), adj = 0.5, col = "white", cex = 2)

```
The asterisks represent significant fractions.
\  
\  
\  




Means of fractions in all extents
```{r}
se <- function(x){
  sd(x)/sqrt(length(x))
}


Means_spatial_extent <- data.frame(Broad_Extent = Varpart_plot[,1],
           Intermediate_Extent = apply(Varpart_plot[,2:3],1,mean),
           Small_Extent = apply(Varpart_plot[,4:11],1,mean))

se_spatial_extent <- data.frame(Intermediate_Extent = apply(Varpart_plot[,2:3],1,se),
           Small_Extent = apply(Varpart_plot[,4:11],1,se))

se_spatial_extent_upper <- Means_spatial_extent[,2:3] + se_spatial_extent
se_spatial_extent_lower <- Means_spatial_extent[,2:3] - se_spatial_extent

Means_spatial_extent
```
\  



```{r, fig.height= 5,fig.width=10,out.width= 1000, out.height=500 , fig.align='center', dpi = 200}
se <- function(x){
  sd(x)/sqrt(length(x))
}
par(mfrow = c(1,3))
barplot(as.matrix(Means_spatial_extent[2,]), axes = F, col = "gold", space = c(0,1,1),
        border = "white", ylim = c(0,0.3), axisnames= F, ylab = "Adjusted R²", cex.lab = 1.25, main = "Environment")
arrows(y0 = c(as.matrix(se_spatial_extent_lower[2,])),
       y1 = c(as.matrix(se_spatial_extent_upper[2,])),
       x1 = c(2.5,4.5),
       x0 = c(2.5,4.5),  code = 3, angle = 90, length = 0.1, lwd = 1)
axis(2, at = c(0,0.05,0.1,0.15,0.2, 0.25,0.3), labels = c("0 %","5 %","10 %","15 %","20 %", "25 %", "30 %"))
axis(1,at = c(0.5,2.5,4.5),line = 0, labels =c("Broad","Intermediate","Small"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.3)


barplot(as.matrix(Means_spatial_extent[4,]), axes = F, col = "cornflowerblue", space = c(0,1,1),
        border = "white", ylim = c(0,0.3), axisnames= F, ylab = "Adjusted R²", cex.lab = 1.25, main = "Space")
arrows(y0 = c(as.matrix(se_spatial_extent_lower[4,])),
       y1 = c(as.matrix(se_spatial_extent_upper[4,])),
       x1 = c(2.5,4.5),
       x0 = c(2.5,4.5),  code = 3, angle = 90, length = 0.1, lwd = 1)
axis(2, at = c(0,0.05,0.1,0.15,0.2, 0.25,0.3), labels = c("0 %","5 %","10 %","15 %","20 %", "25 %", "30 %"))
axis(1,at = c(0.5,2.5,4.5),line = 0, labels =c("Broad","Intermediate","Small"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.3)


barplot(as.matrix(Means_spatial_extent[3,]), axes = F, col = "brown1", space = c(0,1,1),
        border = "white", ylim = c(0,0.3), axisnames= F, ylab = "Adjusted R²", cex.lab = 1.25, main = "Climate")
arrows(y0 = c(as.matrix(se_spatial_extent_lower[3,])),
       y1 = c(as.matrix(se_spatial_extent_upper[3,])),
       x1 = c(2.5,4.5),
       x0 = c(2.5,4.5),  code = 3, angle = 90, length = 0.1, lwd = 1)
axis(2, at = c(0,0.05,0.1,0.15,0.2, 0.25,0.3), labels = c("0 %","5 %","10 %","15 %","20 %", "25 %", "30 %"))
axis(1,at = c(0.5,2.5,4.5),line = 0, labels =c("Broad","Intermediate","Small"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.3)
```
\  
\ 
\ 


```{r, fig.height= 5,fig.width=10,out.width= 1000, out.height=500 , fig.align='center', dpi = 200}
par(mfrow = c(1,3))
barplot(as.matrix(Means_spatial_extent[5,]), axes = F, col = "gold", space = c(0,1,1),
        border = "white", ylim = c(0,0.2), axisnames= F, ylab = "Adjusted R²", cex.lab = 1.25, main = "Pure Environment")
arrows(y0 = c(as.matrix(se_spatial_extent_lower[5,])),
       y1 = c(as.matrix(se_spatial_extent_upper[5,])),
       x1 = c(2.5,4.5),
       x0 = c(2.5,4.5),  code = 3, angle = 90, length = 0.1, lwd = 1)
axis(2, at = c(0,0.05,0.1,0.15,0.2, 0.25,0.3), labels = c("0 %","5 %","10 %","15 %","20 %", "25 %", "30 %"))
axis(1,at = c(0.5,2.5,4.5),line = 0, labels =c("Broad","Intermediate","Small"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.3)


barplot(as.matrix(Means_spatial_extent[7,]), axes = F, col = "cornflowerblue", space = c(0,1,1),
        border = "white", ylim = c(0,0.2), axisnames= F, ylab = "Adjusted R²", cex.lab = 1.25, main = "Pure Space")
arrows(y0 = c(as.matrix(se_spatial_extent_lower[7,])),
       y1 = c(as.matrix(se_spatial_extent_upper[7,])),
       x1 = c(2.5,4.5),
       x0 = c(2.5,4.5),  code = 3, angle = 90, length = 0.1, lwd = 1)
axis(2, at = c(0,0.05,0.1,0.15,0.2, 0.25,0.3), labels = c("0 %","5 %","10 %","15 %","20 %", "25 %", "30 %"))
axis(1,at = c(0.5,2.5,4.5),line = 0, labels =c("Broad","Intermediate","Small"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.3)


barplot(as.matrix(Means_spatial_extent[6,]), axes = F, col = "brown1", space = c(0,1,1),
        border = "white", ylim = c(0,0.2), axisnames= F, ylab = "Adjusted R²", cex.lab = 1.25, main = "Pure Climate")
arrows(y0 = c(as.matrix(se_spatial_extent_lower[6,])),
       y1 = c(as.matrix(se_spatial_extent_upper[6,])),
       x1 = c(2.5,4.5),
       x0 = c(2.5,4.5),  code = 3, angle = 90, length = 0.1, lwd = 1)
axis(2, at = c(0,0.05,0.1,0.15,0.2, 0.25,0.3), labels = c("0 %","5 %","10 %","15 %","20 %", "25 %", "30 %"))
axis(1,at = c(0.5,2.5,4.5),line = 0, labels =c("Broad","Intermediate","Small"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.3)
```
\  
\ 
\ 



```{r, fig.height= 5,fig.width=10,out.width= 1000, out.height=500 , fig.align='center', dpi = 200}
par(mfrow = c(1,3))
barplot(as.matrix(Means_spatial_extent[5,] + Means_spatial_extent[9,]), axes = F, col = "gold", space = c(0,1,1),
        border = "white", ylim = c(0,0.15), axisnames= F, ylab = "Adjusted R²", cex.lab = 1.25)
title(main = "Non-Spatially Structured", line = 2.2)
title(main = "Local Environment", line = 1)
axis(2, at = c(0,0.05,0.1,0.15,0.2, 0.25,0.3), labels = c("0 %","5 %","10 %","15 %","20 %", "25 %", "30 %"))
axis(1,at = c(0.5,2.5,4.5),line = 0, labels =c("Broad","Intermediate","Small"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.3)


barplot(as.matrix(Means_spatial_extent[6,] + Means_spatial_extent[9,]), axes = F, col = "brown1", space = c(0,1,1),
        border = "white", ylim = c(0,0.15), axisnames= F, ylab = "Adjusted R²", cex.lab = 1.25)
title(main = "Non-Spatially Structured", line = 2.2)
title(main = "Climate", line = 1)
axis(2, at = c(0,0.05,0.1,0.15,0.2, 0.25,0.3), labels = c("0 %","5 %","10 %","15 %","20 %", "25 %", "30 %"))
axis(1,at = c(0.5,2.5,4.5),line = 0, labels =c("Broad","Intermediate","Small"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.3)

```
\  
\ 
\ 
Means of fractions in small extent
```{r, fig.height= 5,fig.width=10,out.width= 1000, out.height=500 , fig.align='center', dpi = 200}
Means_small_extent <- data.frame(SSF = apply(Varpart_plot[,4:8],1,mean),
           DRF = apply(Varpart_plot[,9:11],1,mean))

se_small_extent <- data.frame(SSF = apply(Varpart_plot[,4:8],1,se),
           DRF = apply(Varpart_plot[,9:11],1,se))
se_small_extent_upper <- Means_small_extent + se_small_extent
se_small_extent_lower <- Means_small_extent - se_small_extent


par(mfrow = c(1,3))
barplot(as.matrix(Means_small_extent[5,]), axes = F, col = "gold", space = c(0,1),
        border = "white", ylim = c(0,0.25), axisnames= F, ylab = "Adjusted R²", cex.lab = 1.25, main = "Pure Environment")
arrows(y0 = c(as.matrix(se_small_extent_lower[5,])),
       y1 = c(as.matrix(se_small_extent_upper[5,])),
       x1 = c(0.5,2.5),
       x0 = c(0.5,2.5),  code = 3, angle = 90, length = 0.1, lwd = 1)
axis(2, at = c(0,0.05,0.1,0.15,0.2, 0.25,0.3), labels = c("0 %","5 %","10 %","15 %","20 %", "25 %", "30 %"))
axis(1,at = c(0.5,2.5),line = 0, labels =c("SSF","DRF"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.3)



barplot(as.matrix(Means_small_extent[7,]), axes = F, col = "cornflowerblue", space = c(0,1),
        border = "white", ylim = c(0,0.2), axisnames= F, ylab = "Adjusted R²", cex.lab = 1.25, main = "Pure Space")
arrows(y0 = c(as.matrix(se_small_extent_lower[7,])),
       y1 = c(as.matrix(se_small_extent_upper[7,])),
       x1 = c(0.5,2.5),
       x0 = c(0.5,2.5),  code = 3, angle = 90, length = 0.1, lwd = 1)
axis(2, at = c(0,0.05,0.1,0.15,0.2, 0.25,0.3), labels = c("0 %","5 %","10 %","15 %","20 %", "25 %", "30 %"))
axis(1,at = c(0.5,2.5),line = 0, labels =c("SSF","DRF"), tick = F,las = 1, hadj = 0.5, cex.axis = 1.3)

```
\  





\  
\    
\  
\      

To better understand what are the environmental variables that are important in each fraction, we looked at the RDA plots of environmental variables (local Environment and Climate) both unconstrained alone and constrained by spatial variables, that is, with and without the importance spatially structured variables.

Because here we are not looking at p or R2 values, we are not woried about multicolinearity or overfitting, so we are using all climate and environmental variables.

### Intermediate Extent

```{r, fig.height= 6,fig.width=12,out.width= 800, out.height=400 , fig.align='center', dpi = 200}
RDA_clim_SSF <- rda(SSF_pa, data.frame(SSF_clim_st,SSF_env_st))

species_scores_SSF <- scores(RDA_clim_SSF, display = c( "species"), scaling = 0, hill = T)
loadings_SSF <- scores(RDA_clim_SSF, display = c( "bp"), scaling = 0, hill = T)

species_scores_SSF <- species_scores_SSF[(species_scores_SSF[,1] > 0.25 | species_scores_SSF[,1] < -0.25) | 
                                         (species_scores_SSF[,2] > 0.25 | species_scores_SSF[,2] < -0.25) ,]

#species_scores_SSF <- species_scores_SSF*1.5

xmin <- #min(c(species_scores_SSF[,1], loadings_SSF[,1])) -0.2
 -1
xmax <- #max(c(species_scores_SSF[,1], loadings_SSF[,1])) +0.2
 1
ymin <- #min(c(species_scores_SSF[,2], loadings_SSF[,2])) -0.2
  -1
ymax <- #max(c(species_scores_SSF[,2], loadings_SSF[,2])) +0.2
  1

rownames(loadings_SSF) <- c("TS","RT","TP","PS","HYD","CC","ARE","DEP","VH")
col_SSF <- c("brown1","brown1","brown1","brown1","darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")


dists_SSF <- as.matrix(dist(rbind(loadings_SSF,c(0,0))))[10,-10]
dists_SSF_prop <- dists_SSF/max(dists_SSF)

#for(i in 1:length(col_SSF)){
#  col_SSF[i] <- lighten_color((1-dists_SSF_prop[i]),col_SSF[i])
#}

par(mfrow = c(1,2),mar = c(5, 5, 4, 2))
plot(RDA_clim_SSF, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "SSF - Unconstrained")
for(i in 1:length(species_scores_SSF[,1])){
  #points(species_scores_SSF[i,1], species_scores_SSF[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_SSF[i,1], species_scores_SSF[i,2], labels = rownames(species_scores_SSF)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_SSF[,1])),
              y0 = rep(0, length(loadings_SSF[,1])),
              x1 = loadings_SSF[,1],
              y1 = loadings_SSF[,2], col = col_SSF, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_SSF_prop), arr.width = 0.3*(dists_SSF_prop))

for(i in 1:length(loadings_SSF[,1])){
  #points(loadings_SSF[i,1], loadings_SSF[i,2], col = col_SSF[i], pch = 21, cex = ((7*dists_SSF_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_SSF[i,1]*1.2, loadings_SSF[i,2]*1.2, labels = rownames(loadings_SSF)[i],col = col_SSF[i], cex = (1.4*dists_SSF_prop[i]))
}


#########################RDA SSF Constrained
RDA_clim_SSF <- rda(SSF_pa, data.frame(SSF_clim_st,SSF_env_st), data.frame(SSF_dbMEM_FS))


species_scores_SSF <- scores(RDA_clim_SSF, display = c( "species"), scaling = 0, hill = T)
loadings_SSF <- scores(RDA_clim_SSF, display = c( "bp"), scaling = 0, hill = T)

species_scores_SSF <- species_scores_SSF[(species_scores_SSF[,1] > 0.25 | species_scores_SSF[,1] < -0.25) | 
                                         (species_scores_SSF[,2] > 0.25 | species_scores_SSF[,2] < -0.25) ,]

#species_scores_SSF <- species_scores_SSF*1.5

xmin <- #min(c(species_scores_SSF[,1], loadings_SSF[,1])) -0.2
  -1
xmax <- #max(c(species_scores_SSF[,1], loadings_SSF[,1])) +0.2
  1

ymin <- #min(c(species_scores_SSF[,2], loadings_SSF[,2])) -0.2
  -1
ymax <- #max(c(species_scores_SSF[,2], loadings_SSF[,2])) +0.2
  1

rownames(loadings_SSF) <- c("TS","RT","TP","PS","HYD","CC","ARE","DEP","VH")
col_SSF <- c("brown1","brown1","brown1","brown1","darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")

dists_SSF <- as.matrix(dist(rbind(loadings_SSF,c(0,0))))[10,-10]
dists_SSF_prop <- dists_SSF/max(dists_SSF)

#for(i in 1:length(col_SSF)){
#  col_SSF[i] <- lighten_color((1-dists_SSF_prop[i]),col_SSF[i])
#}


plot(RDA_clim_SSF, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "SSF - Constrained")
for(i in 1:length(species_scores_SSF[,1])){
  #points(species_scores_SSF[i,1], species_scores_SSF[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_SSF[i,1], species_scores_SSF[i,2], labels = rownames(species_scores_SSF)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_SSF[,1])),
              y0 = rep(0, length(loadings_SSF[,1])),
              x1 = loadings_SSF[,1],
              y1 = loadings_SSF[,2], col = col_SSF, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_SSF_prop), arr.width = 0.3*(dists_SSF_prop))

for(i in 1:length(loadings_SSF[,1])){
  #points(loadings_SSF[i,1], loadings_SSF[i,2], col = col_SSF[i], pch = 21, cex = ((7*dists_SSF_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_SSF[i,1]*1.2, loadings_SSF[i,2]*1.2, labels = rownames(loadings_SSF)[i],col = col_SSF[i], cex = (1.4*dists_SSF_prop[i]))
}

```



```{r, fig.height= 6,fig.width=12,out.width= 800, out.height=400 , fig.align='center', dpi = 200}
RDA_clim_DRF <- rda(DRF_pa, data.frame(DRF_clim_st,DRF_env_st))

species_scores_DRF <- scores(RDA_clim_DRF, display = c( "species"), scaling = 0, hill = T)
loadings_DRF <- scores(RDA_clim_DRF, display = c( "bp"), scaling = 0, hill = T)

species_scores_DRF <- species_scores_DRF[(species_scores_DRF[,1] > 0.25 | species_scores_DRF[,1] < -0.25) | 
                                         (species_scores_DRF[,2] > 0.25 | species_scores_DRF[,2] < -0.25) ,]

#species_scores_DRF <- species_scores_DRF*1.5

xmin <- #min(c(species_scores_DRF[,1], loadings_DRF[,1])) -0.2
  -1
xmax <- #max(c(species_scores_DRF[,1], loadings_DRF[,1])) +0.2
  1

ymin <- #min(c(species_scores_DRF[,2], loadings_DRF[,2])) -0.2
  -1
ymax <- #max(c(species_scores_DRF[,2], loadings_DRF[,2])) +0.2
  1

rownames(loadings_DRF) <- c("TS","RT","TP","PS","HYD","CC","ARE","DEP","VH")
col_DRF <- c("brown1","brown1","brown1","brown1","darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")


dists_DRF <- as.matrix(dist(rbind(loadings_DRF,c(0,0))))[10,-10]
dists_DRF_prop <- dists_DRF/max(dists_DRF)

#for(i in 1:length(col_DRF)){
#  col_DRF[i] <- lighten_color((1-dists_DRF_prop[i]),col_DRF[i])
#}

par(mfrow = c(1,2),mar = c(5, 5, 4, 2))
plot(RDA_clim_DRF, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "DRF - Unconstrained")
for(i in 1:length(species_scores_DRF[,1])){
  #points(species_scores_DRF[i,1], species_scores_DRF[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_DRF[i,1], species_scores_DRF[i,2], labels = rownames(species_scores_DRF)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_DRF[,1])),
              y0 = rep(0, length(loadings_DRF[,1])),
              x1 = loadings_DRF[,1],
              y1 = loadings_DRF[,2], col = col_DRF, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_DRF_prop), arr.width = 0.3*(dists_DRF_prop))

for(i in 1:length(loadings_DRF[,1])){
  #points(loadings_DRF[i,1], loadings_DRF[i,2], col = col_DRF[i], pch = 21, cex = ((7*dists_DRF_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_DRF[i,1]*1.2, loadings_DRF[i,2]*1.2, labels = rownames(loadings_DRF)[i],col = col_DRF[i], cex = (1.4*dists_DRF_prop[i]))
}


#########################RDA DRF Constrained
RDA_clim_DRF <- rda(DRF_pa, data.frame(DRF_clim_st,DRF_env_st), data.frame(DRF_dbMEM_FS))


species_scores_DRF <- scores(RDA_clim_DRF, display = c( "species"), scaling = 0, hill = T)
loadings_DRF <- scores(RDA_clim_DRF, display = c( "bp"), scaling = 0, hill = T)

species_scores_DRF <- species_scores_DRF[(species_scores_DRF[,1] > 0.25 | species_scores_DRF[,1] < -0.25) | 
                                         (species_scores_DRF[,2] > 0.25 | species_scores_DRF[,2] < -0.25) ,]

#species_scores_DRF <- species_scores_DRF*1.5

xmin <- #min(c(species_scores_DRF[,1], loadings_DRF[,1])) -0.2
  -1
xmax <- #max(c(species_scores_DRF[,1], loadings_DRF[,1])) +0.2
  1

ymin <- #min(c(species_scores_DRF[,2], loadings_DRF[,2])) -0.2
  -1
ymax <- #max(c(species_scores_DRF[,2], loadings_DRF[,2])) +0.2
  1


rownames(loadings_DRF) <- c("TS","RT","TP","PS","HYD","CC","ARE","DEP","VH")
col_DRF <- c("brown1","brown1","brown1","brown1","darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")

dists_DRF <- as.matrix(dist(rbind(loadings_DRF,c(0,0))))[10,-10]
dists_DRF_prop <- dists_DRF/max(dists_DRF)

#for(i in 1:length(col_DRF)){
#  col_DRF[i] <- lighten_color((1-dists_DRF_prop[i]),col_DRF[i])
#}


plot(RDA_clim_DRF, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "DRF - Constrained")
for(i in 1:length(species_scores_DRF[,1])){
  #points(species_scores_DRF[i,1], species_scores_DRF[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_DRF[i,1], species_scores_DRF[i,2], labels = rownames(species_scores_DRF)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_DRF[,1])),
              y0 = rep(0, length(loadings_DRF[,1])),
              x1 = loadings_DRF[,1],
              y1 = loadings_DRF[,2], col = col_DRF, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_DRF_prop), arr.width = 0.3*(dists_DRF_prop))

for(i in 1:length(loadings_DRF[,1])){
  #points(loadings_DRF[i,1], loadings_DRF[i,2], col = col_DRF[i], pch = 21, cex = ((7*dists_DRF_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_DRF[i,1]*1.2, loadings_DRF[i,2]*1.2, labels = rownames(loadings_DRF)[i],col = col_DRF[i], cex = (1.4*dists_DRF_prop[i]))
}

```

\  
\    
\  
\     


### Small Extent

Because there were no shared fractions between spatial and environmental variables at small spatial extent, we only plotted constrained ordinations.

#### SSF

```{r, fig.height= 6,fig.width=12,out.width= 800, out.height=400 , fig.align='center', dpi = 200, fig.show="hold"}
#SANTA FÈ DO SUL
RDA_clim_ST <- rda(ST_pa, data.frame(ST_env_st), data.frame(ST_dbMEM_FS))


species_scores_ST <- scores(RDA_clim_ST, display = c( "species"), scaling = 0, hill = T)
loadings_ST <- scores(RDA_clim_ST, display = c( "bp"), scaling = 0, hill = T)

species_scores_ST <- species_scores_ST[(species_scores_ST[,1] > 0.25 | species_scores_ST[,1] < -0.25) | 
                                         (species_scores_ST[,2] > 0.25 | species_scores_ST[,2] < -0.25) ,]

species_scores_ST <- species_scores_ST*1.5

xmin <- min(c(species_scores_ST[,1], loadings_ST[,1])) -0.2
xmax <- max(c(species_scores_ST[,1], loadings_ST[,1])) +0.2

ymin <- min(c(species_scores_ST[,2], loadings_ST[,2])) -0.2
ymax <- max(c(species_scores_ST[,2], loadings_ST[,2])) +0.2

rownames(loadings_ST) <- c("HYD","ARE","DEP","VH")
col_ST <- c("darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")

dists_ST <- as.matrix(dist(rbind(loadings_ST,c(0,0))))[5,-5]
dists_ST_prop <- dists_ST/max(dists_ST)

for(i in 1:length(col_ST)){
  col_ST[i] <- lighten_color((1-dists_ST_prop[i]),col_ST[i])
}

par(mfrow = c(1,2),mar = c(5, 5, 4, 2))
plot(RDA_clim_ST, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "ST - Constrained")
for(i in 1:length(species_scores_ST[,1])){
  #points(species_scores_ST[i,1], species_scores_ST[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_ST[i,1], species_scores_ST[i,2], labels = rownames(species_scores_ST)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_ST[,1])),
              y0 = rep(0, length(loadings_ST[,1])),
              x1 = loadings_ST[,1],
              y1 = loadings_ST[,2], col = col_ST, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_ST_prop), arr.width = 0.3*(dists_ST_prop))

for(i in 1:length(loadings_ST[,1])){
  #points(loadings_ST[i,1], loadings_ST[i,2], col = col_ST[i], pch = 21, cex = ((7*dists_ST_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_ST[i,1]*1.25, loadings_ST[i,2]*1.25, labels = rownames(loadings_ST)[i],col = col_ST[i], cex = (1.4*dists_ST_prop[i]))
}

#ICÉM
RDA_clim_IC <- rda(IC_pa, data.frame(IC_env_st), data.frame(IC_dbMEM_FS))


species_scores_IC <- scores(RDA_clim_IC, display = c( "species"), scaling = 0, hill = T)
loadings_IC <- scores(RDA_clim_IC, display = c( "bp"), scaling = 0, hill = T)

species_scores_IC <- species_scores_IC[(species_scores_IC[,1] > 0.25 | species_scores_IC[,1] < -0.25) | 
                                         (species_scores_IC[,2] > 0.25 | species_scores_IC[,2] < -0.25) ,]

species_scores_IC <- species_scores_IC*1.5

xmin <- min(c(species_scores_IC[,1], loadings_IC[,1])) -0.2
xmax <- max(c(species_scores_IC[,1], loadings_IC[,1])) +0.2

ymin <- min(c(species_scores_IC[,2], loadings_IC[,2])) -0.2
ymax <- max(c(species_scores_IC[,2], loadings_IC[,2])) +0.2

rownames(loadings_IC) <- c("HYD","ARE","DEP","VH")
col_IC <- c("darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")

dists_IC <- as.matrix(dist(rbind(loadings_IC,c(0,0))))[5,-5]
dists_IC_prop <- dists_IC/max(dists_IC)

for(i in 1:length(col_IC)){
  col_IC[i] <- lighten_color((1-dists_IC_prop[i]),col_IC[i])
}

plot(RDA_clim_IC, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "IC - Constrained")
for(i in 1:length(species_scores_IC[,1])){
  #points(species_scores_IC[i,1], species_scores_IC[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_IC[i,1], species_scores_IC[i,2], labels = rownames(species_scores_IC)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_IC[,1])),
              y0 = rep(0, length(loadings_IC[,1])),
              x1 = loadings_IC[,1],
              y1 = loadings_IC[,2], col = col_IC, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_IC_prop), arr.width = 0.3*(dists_IC_prop))

for(i in 1:length(loadings_IC[,1])){
  #points(loadings_IC[i,1], loadings_IC[i,2], col = col_IC[i], pch = 21, cex = ((7*diICs_IC_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_IC[i,1]*1.25, loadings_IC[i,2]*1.25, labels = rownames(loadings_IC)[i],col = col_IC[i], cex = (1.4*dists_IC_prop[i]))
}

#NOVA ITAPIREMA
RDA_clim_NI <- rda(NI_pa, data.frame(NI_env_st), data.frame(NI_dbMEM_FS))


species_scores_NI <- scores(RDA_clim_NI, display = c( "species"), scaling = 0, hill = T)
loadings_NI <- scores(RDA_clim_NI, display = c( "bp"), scaling = 0, hill = T)

species_scores_NI <- species_scores_NI[(species_scores_NI[,1] > 0.25 | species_scores_NI[,1] < -0.25) | 
                                         (species_scores_NI[,2] > 0.25 | species_scores_NI[,2] < -0.25) ,]

species_scores_NI <- species_scores_NI*1.5

xmin <- min(c(species_scores_NI[,1], loadings_NI[,1])) -0.2
xmax <- max(c(species_scores_NI[,1], loadings_NI[,1])) +0.2

ymin <- min(c(species_scores_NI[,2], loadings_NI[,2])) -0.2
ymax <- max(c(species_scores_NI[,2], loadings_NI[,2])) +0.2

rownames(loadings_NI) <- c("HYD","ARE","DEP","VH")
col_NI <- c("darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")

dists_NI <- as.matrix(dist(rbind(loadings_NI,c(0,0))))[5,-5]
dists_NI_prop <- dists_NI/max(dists_NI)

for(i in 1:length(col_NI)){
  col_NI[i] <- lighten_color((1-dists_NI_prop[i]),col_NI[i])
}

plot(RDA_clim_NI, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "NI - Constrained")
for(i in 1:length(species_scores_NI[,1])){
  #points(species_scores_NI[i,1], species_scores_NI[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_NI[i,1], species_scores_NI[i,2], labels = rownames(species_scores_NI)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_NI[,1])),
              y0 = rep(0, length(loadings_NI[,1])),
              x1 = loadings_NI[,1],
              y1 = loadings_NI[,2], col = col_NI, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_NI_prop), arr.width = 0.3*(dists_NI_prop))

for(i in 1:length(loadings_NI[,1])){
  #points(loadings_NI[i,1], loadings_NI[i,2], col = col_NI[i], pch = 21, cex = ((7*diNIs_NI_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_NI[i,1]*1.25, loadings_NI[i,2]*1.25, labels = rownames(loadings_NI)[i],col = col_NI[i], cex = (1.4*dists_NI_prop[i]))
}



#MORRO DO DIABO
RDA_clim_MD <- rda(MD_pa, data.frame(MD_env_st), data.frame(MD_dbMEM_FS))


species_scores_MD <- scores(RDA_clim_MD, display = c( "species"), scaling = 0, hill = T)
loadings_MD <- scores(RDA_clim_MD, display = c( "bp"), scaling = 0, hill = T)

species_scores_MD <- species_scores_MD[(species_scores_MD[,1] > 0.25 | species_scores_MD[,1] < -0.25) | 
                                         (species_scores_MD[,2] > 0.25 | species_scores_MD[,2] < -0.25) ,]

species_scores_MD <- species_scores_MD*1.5

xmin <- min(c(species_scores_MD[,1], loadings_MD[,1])) -0.2
xmax <- max(c(species_scores_MD[,1], loadings_MD[,1])) +0.2

ymin <- min(c(species_scores_MD[,2], loadings_MD[,2])) -0.2
ymax <- max(c(species_scores_MD[,2], loadings_MD[,2])) +0.2

rownames(loadings_MD) <- c("HYD","CC","ARE","DEP","VH")
col_MD <- c("darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")

dists_MD <- as.matrix(dist(rbind(loadings_MD,c(0,0))))[6,-6]
dists_MD_prop <- dists_MD/max(dists_MD)

for(i in 1:length(col_MD)){
  col_MD[i] <- lighten_color((1-dists_MD_prop[i]),col_MD[i])
}

plot(RDA_clim_MD, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "MD - Constrained")
for(i in 1:length(species_scores_MD[,1])){
  #points(species_scores_MD[i,1], species_scores_MD[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_MD[i,1], species_scores_MD[i,2], labels = rownames(species_scores_MD)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_MD[,1])),
              y0 = rep(0, length(loadings_MD[,1])),
              x1 = loadings_MD[,1],
              y1 = loadings_MD[,2], col = col_MD, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_MD_prop), arr.width = 0.3*(dists_MD_prop))

for(i in 1:length(loadings_MD[,1])){
  #points(loadings_MD[i,1], loadings_MD[i,2], col = col_MD[i], pch = 21, cex = ((7*diNIs_MD_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_MD[i,1]*1.25, loadings_MD[i,2]*1.25, labels = rownames(loadings_MD)[i],col = col_MD[i], cex = (1.4*dists_MD_prop[i]))
}


#JATAÍ
RDA_clim_JA <- rda(JA_pa, data.frame(JA_env_st), data.frame(JA_dbMEM_FS))


species_scores_JA <- scores(RDA_clim_JA, display = c( "species"), scaling = 0, hill = T)
loadings_JA <- scores(RDA_clim_JA, display = c( "bp"), scaling = 0, hill = T)

species_scores_JA <- species_scores_JA[(species_scores_JA[,1] > 0.25 | species_scores_JA[,1] < -0.25) | 
                                         (species_scores_JA[,2] > 0.25 | species_scores_JA[,2] < -0.25) ,]

species_scores_JA <- species_scores_JA*1.5

xmin <- min(c(species_scores_JA[,1], loadings_JA[,1])) -0.2
xmax <- max(c(species_scores_JA[,1], loadings_JA[,1])) +0.2

ymin <- min(c(species_scores_JA[,2], loadings_JA[,2])) -0.2
ymax <- max(c(species_scores_JA[,2], loadings_JA[,2])) +0.2

rownames(loadings_JA) <- c("HYD","CC","ARE","DEP","VH")
col_JA <- c("darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")

dists_JA <- as.matrix(dist(rbind(loadings_JA,c(0,0))))[6,-6]
dists_JA_prop <- dists_JA/max(dists_JA)

for(i in 1:length(col_JA)){
  col_JA[i] <- lighten_color((1-dists_JA_prop[i]),col_JA[i])
}

plot(RDA_clim_JA, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "JA - Constrained")
for(i in 1:length(species_scores_JA[,1])){
  #points(species_scores_JA[i,1], species_scores_JA[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_JA[i,1], species_scores_JA[i,2], labels = rownames(species_scores_JA)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_JA[,1])),
              y0 = rep(0, length(loadings_JA[,1])),
              x1 = loadings_JA[,1],
              y1 = loadings_JA[,2], col = col_JA, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_JA_prop), arr.width = 0.3*(dists_JA_prop))

for(i in 1:length(loadings_JA[,1])){
  #points(loadings_JA[i,1], loadings_JA[i,2], col = col_JA[i], pch = 21, cex = ((7*diNIs_JA_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_JA[i,1]*1.25, loadings_JA[i,2]*1.25, labels = rownames(loadings_JA)[i],col = col_JA[i], cex = (1.4*dists_JA_prop[i]))
}
```

\  
\    
\  
\     

#### DRF

```{r, fig.height= 6,fig.width=12,out.width= 800, out.height=400 , fig.align='center', dpi = 200, fig.show="hold"}
#UBATUBA
RDA_clim_UBA <- rda(UBA_pa, data.frame(UBA_env_st), data.frame(UBA_dbMEM_FS))


species_scores_UBA <- scores(RDA_clim_UBA, display = c( "species"), scaling = 0, hill = T)
loadings_UBA <- scores(RDA_clim_UBA, display = c( "bp"), scaling = 0, hill = T)

species_scores_UBA <- species_scores_UBA[(species_scores_UBA[,1] > 0.25 | species_scores_UBA[,1] < -0.25) | 
                                         (species_scores_UBA[,2] > 0.25 | species_scores_UBA[,2] < -0.25) ,]

species_scores_UBA <- species_scores_UBA*1.5

xmin <- min(c(species_scores_UBA[,1], loadings_UBA[,1])) -0.2
xmax <- max(c(species_scores_UBA[,1], loadings_UBA[,1])) +0.2

ymin <- min(c(species_scores_UBA[,2], loadings_UBA[,2])) -0.2
ymax <- max(c(species_scores_UBA[,2], loadings_UBA[,2])) +0.2

rownames(loadings_UBA) <- c("HYD","CC","ARE","DEP")
col_UBA <- c("darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")

dists_UBA <- as.matrix(dist(rbind(loadings_UBA,c(0,0))))[5,-5]
dists_UBA_prop <- dists_UBA/max(dists_UBA)

for(i in 1:length(col_UBA)){
  col_UBA[i] <- lighten_color((1-dists_UBA_prop[i]),col_UBA[i])
}

par(mfrow = c(1,2),mar = c(5, 5, 4, 2))
plot(RDA_clim_UBA, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "UBA - Constrained")
for(i in 1:length(species_scores_UBA[,1])){
  #points(species_scores_UBA[i,1], species_scores_UBA[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_UBA[i,1], species_scores_UBA[i,2], labels = rownames(species_scores_UBA)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_UBA[,1])),
              y0 = rep(0, length(loadings_UBA[,1])),
              x1 = loadings_UBA[,1],
              y1 = loadings_UBA[,2], col = col_UBA, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_UBA_prop), arr.width = 0.3*(dists_UBA_prop))

for(i in 1:length(loadings_UBA[,1])){
  #points(loadings_UBA[i,1], loadings_UBA[i,2], col = col_UBA[i], pch = 21, cex = ((7*diNIs_UBA_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_UBA[i,1]*1.25, loadings_UBA[i,2]*1.25, labels = rownames(loadings_UBA)[i],col = col_UBA[i], cex = (1.4*dists_UBA_prop[i]))
}

#BERTIOGA
RDA_clim_BER <- rda(BER_pa, data.frame(BER_env_st), data.frame(BER_dbMEM_FS))


species_scores_BER <- scores(RDA_clim_BER, display = c( "species"), scaling = 0, hill = T)
loadings_BER <- scores(RDA_clim_BER, display = c( "bp"), scaling = 0, hill = T)

species_scores_BER <- species_scores_BER[(species_scores_BER[,1] > 0.25 | species_scores_BER[,1] < -0.25) | 
                                         (species_scores_BER[,2] > 0.25 | species_scores_BER[,2] < -0.25) ,]

species_scores_BER <- species_scores_BER*1.5

xmin <- min(c(species_scores_BER[,1], loadings_BER[,1])) -0.2
xmax <- max(c(species_scores_BER[,1], loadings_BER[,1])) +0.2

ymin <- min(c(species_scores_BER[,2], loadings_BER[,2])) -0.2
ymax <- max(c(species_scores_BER[,2], loadings_BER[,2])) +0.2

rownames(loadings_BER) <- c("HYD","CC","ARE","DEP")
col_BER <- c("darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")

dists_BER <- as.matrix(dist(rbind(loadings_BER,c(0,0))))[5,-5]
dists_BER_prop <- dists_BER/max(dists_BER)

for(i in 1:length(col_BER)){
  col_BER[i] <- lighten_color((1-dists_BER_prop[i]),col_BER[i])
}

plot(RDA_clim_BER, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "BER - Constrained")
for(i in 1:length(species_scores_BER[,1])){
  #points(species_scores_BER[i,1], species_scores_BER[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_BER[i,1], species_scores_BER[i,2], labels = rownames(species_scores_BER)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_BER[,1])),
              y0 = rep(0, length(loadings_BER[,1])),
              x1 = loadings_BER[,1],
              y1 = loadings_BER[,2], col = col_BER, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_BER_prop), arr.width = 0.3*(dists_BER_prop))

for(i in 1:length(loadings_BER[,1])){
  #points(loadings_BER[i,1], loadings_BER[i,2], col = col_BER[i], pch = 21, cex = ((7*diNIs_BER_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_BER[i,1]*1.25, loadings_BER[i,2]*1.25, labels = rownames(loadings_BER)[i],col = col_BER[i], cex = (1.4*dists_BER_prop[i]))
}

#ITANHAÉM
RDA_clim_ITA <- rda(ITA_pa, data.frame(ITA_env_st), data.frame(ITA_dbMEM_FS))


species_scores_ITA <- scores(RDA_clim_ITA, display = c( "species"), scaling = 0, hill = T)
loadings_ITA <- scores(RDA_clim_ITA, display = c( "bp"), scaling = 0, hill = T)

species_scores_ITA <- species_scores_ITA[(species_scores_ITA[,1] > 0.25 | species_scores_ITA[,1] < -0.25) | 
                                         (species_scores_ITA[,2] > 0.25 | species_scores_ITA[,2] < -0.25) ,]

species_scores_ITA <- species_scores_ITA*1.5

xmin <- min(c(species_scores_ITA[,1], loadings_ITA[,1])) -0.2
xmax <- max(c(species_scores_ITA[,1], loadings_ITA[,1])) +0.2

ymin <- min(c(species_scores_ITA[,2], loadings_ITA[,2])) -0.2
ymax <- max(c(species_scores_ITA[,2], loadings_ITA[,2])) +0.2

rownames(loadings_ITA) <- c("HYD","CC","ARE","DEP","VH")
col_ITA <- c("darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod","darkgoldenrod")

dists_ITA <- as.matrix(dist(rbind(loadings_ITA,c(0,0))))[6,-6]
dists_ITA_prop <- dists_ITA/max(dists_ITA)

for(i in 1:length(col_ITA)){
  col_ITA[i] <- lighten_color((1-dists_ITA_prop[i]),col_ITA[i])
}

plot(RDA_clim_ITA, type="n", scaling = 2, xlim = c(xmin,xmax), ylim = c(ymin,ymax), cex.lab = 1.5, cex.axis = 1.5, main = "ITA - Constrained")
for(i in 1:length(species_scores_ITA[,1])){
  #points(species_scores_ITA[i,1], species_scores_ITA[i,2], col = "white", pch = 21, cex = 5, bg = "grey80", lwd = 1)
  text(species_scores_ITA[i,1], species_scores_ITA[i,2], labels = rownames(species_scores_ITA)[i],col = "black", cex = 0.8)
}

shape::Arrows(x0 = rep(0, length(loadings_ITA[,1])),
              y0 = rep(0, length(loadings_ITA[,1])),
              x1 = loadings_ITA[,1],
              y1 = loadings_ITA[,2], col = col_ITA, lwd = 2, arr.type="triangle", arr.length = 0.4*(dists_ITA_prop), arr.width = 0.3*(dists_ITA_prop))

for(i in 1:length(loadings_ITA[,1])){
  #points(loadings_ITA[i,1], loadings_ITA[i,2], col = col_ITA[i], pch = 21, cex = ((7*diNIs_ITA_prop[i])+1), bg = "white", lwd = 3)
  text(loadings_ITA[i,1]*1.25, loadings_ITA[i,2]*1.25, labels = rownames(loadings_ITA)[i],col = col_ITA[i], cex = (1.4*dists_ITA_prop[i]))
}

```

